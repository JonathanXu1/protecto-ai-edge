<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Protecto</title>
    <!-- Materialize css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <!-- icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  </head>
  //TEST PORTION FROM HACKSTER.IO MQTT WEBSOCKET
  <script type = "text/javascript">
  var BrokerURI="ns01-wss.brainium.com";
  var MQTTUserName="oauth2-user";
  var ExternalAccessToken=""; //put your access key here
  var PlatformUserId = ""; //put your User ID here
  var mqtt;
  var port = 443;
  var DeviceID = ""; //put your Device ID here;
  var topic = "VISIBLE_SPECTRUM_LIGHTNESS";
  var MotionTopic = "/v1/users/" + PlatformUserId + "/in/devices/" + DeviceID + "/datasources/" + topic;
  function onConnectionLost(){
   status_messages.innerHTML ="Connection Lost";
  };
  function onConnect() {
   mqtt.subscribe(MotionTopic);
   status_messages.innerHTML = "Subscribed to topic "+topic;
  }; 
  function onMessageArrived(r_message){
   var payload = r_message.payloadString;
   var messageString = payload.replace('[','').replace(']','');
   var splitMessage = messageString.split("},{")
   var arraylength = splitMessage.length;
   for (var i = 0; i < arraylength; i++){
       if (i==0){
         out_messages.innerHTML=splitMessage[i].replace('{','')+"<br/>";
       } else {
         out_messages.innerHTML+=splitMessage[i].replace('}','')+"<br/>";
       }
    }
   };
  function MQTTconnect() {
   status_messages.innerHTML = "connecting to "+ BrokerURI;
   mqtt = new Paho.MQTT.Client(BrokerURI,port,"clientjs");
    var options = {userName: MQTTUserName,
             password: ExternalAccessToken,
             timeout: 3,   
             onSuccess: onConnect, };
   mqtt.connect(options);
   mqtt.onConnectionLost = onConnectionLost;
   mqtt.onMessageArrived = onMessageArrived;
  };
</script>
  <body>

    <nav>
      <div class="nav-wrapper">
        <a href="#" class="brand-logo center">Protecto</a>
      </div>
    </nav>

    <h4>Dashboard</h4>

    <div class="row">
      <div class="col s6 m3">
        <div class="card blue-grey darken-1">
          <div class="card-content white-text center-align">
            <span class="card-title center">Vibration</span>
            <i class="large material-icons">vibration</i>
          </div>
          <div>
            <p>Stable</p>
          </div>
        </div>
      </div>
      <div class="col s6 m3">
        <div class="card blue-grey darken-1">
          <div class="card-content white-text center-align">
            <span class="card-title center">Humidity</span>
            <i class="large material-icons">invert_colors</i>
          </div>
          <div>
            <p>Stable</p>
          </div>
        </div>
      </div>
      <div class="col s6 m3">
        <div class="card blue-grey darken-1">
          <div class="card-content white-text center-align">
            <span class="card-title center">Light Level</span>
            <i class="large material-icons">wb_incandescent</i>
          </div>
          <div>
            <p>Stable</p>
          </div>
        </div>
      </div>
      <div class="col s6 m3">
        <div class="card blue-grey darken-1">
          <div class="card-content white-text center-align">
            <span class="card-title center">Temperature</span>
            <i class="large material-icons">ac_unit</i>
          </div>
          <div>
            <p>Stable</p>
          </div>
        </div>
      </div>
    </div>

    <h4>History</h4>

    <table class="striped">
      <thead>
        <tr>
            <th>Timestamp</th>
            <th>Sensor</th>
            <th>Status</th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>Alvin</td>
          <td>Eclair</td>
          <td>$0.87</td>
        </tr>
        <tr>
          <td>Alan</td>
          <td>Jellybean</td>
          <td>$3.76</td>
        </tr>
        <tr>
          <td>Jonathan</td>
          <td>Lollipop</td>
          <td>$7.00</td>
        </tr>
      </tbody>
    </table>

    <!-- Materialize css -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  </body>
</html>
